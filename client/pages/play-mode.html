<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chá»n cháº¿ Ä‘á»™ chÆ¡i - Chess Online P2P</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>â™Ÿï¸ Chess Online P2P</h1>
      <div class="user-info">
        <span id="player-name">Player</span>
        <button id="logout-btn" class="btn btn-secondary btn-sm">ÄÄƒng xuáº¥t</button>
      </div>
    </div>

    <div class="play-mode-container">
      <h2>Chá»n cháº¿ Ä‘á»™ chÆ¡i</h2>
      
      <div class="mode-selection">
        <div class="mode-card">
          <div class="mode-icon">ğŸ†</div>
          <h3>Ranking Match</h3>
          <p>Thi Ä‘áº¥u xáº¿p háº¡ng vá»›i ngÆ°á»i chÆ¡i cÃ¹ng trÃ¬nh Ä‘á»™. TÃ¬m Ä‘á»‘i thá»§ vá»›i Ä‘iá»ƒm sá»‘ chÃªnh lá»‡ch khÃ´ng quÃ¡ 50 Ä‘iá»ƒm.</p>
          <p></p>
          <button id="ranking-btn" class="btn btn-primary btn-large">ChÆ¡i Ranking</button>
        </div>

        <div class="mode-card">
          <div class="mode-icon">ğŸ®</div>
          <h3>Custom Match</h3>
          <p>Táº¡o hoáº·c tham gia phÃ²ng tÃ¹y chá»‰nh. ChÆ¡i vá»›i báº¡n bÃ¨ hoáº·c ngÆ°á»i chÆ¡i khÃ¡c.</p>
          <p></p>
          <button id="custom-btn" class="btn btn-success btn-large">ChÆ¡i Custom</button>
        </div>
      </div>

      <div class="stats-section">
        <h3>Thá»‘ng kÃª cá»§a báº¡n</h3>
        <div id="player-stats" class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Äiá»ƒm</div>
            <div class="stat-value" id="stat-points">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Tráº­n tháº¯ng</div>
            <div class="stat-value" id="stat-wins">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Tráº­n thua</div>
            <div class="stat-value" id="stat-losses">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">HÃ²a</div>
            <div class="stat-value" id="stat-draws">0</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/websocket.js"></script>
  <script src="/js/main.js"></script>
  <script>
    const player = getCurrentPlayer();
    if (!player) {
      window.location.href = '/login';
    }

    document.getElementById('player-name').textContent = player.displayname || player.username;

    // Load player stats
    fetch(`/api/players/${player.player_id}/stats`)
      .then(res => res.json())
      .then(data => {
        if (data.success && data.stats) {
          document.getElementById('stat-points').textContent = data.stats.point;
          document.getElementById('stat-wins').textContent = data.stats.wins;
          document.getElementById('stat-losses').textContent = data.stats.losses;
          document.getElementById('stat-draws').textContent = data.stats.draws;
        }
      });

    // Ranking button
    document.getElementById('ranking-btn').addEventListener('click', () => {
      window.location.href = '/ranking';
    });

    // Custom button
    document.getElementById('custom-btn').addEventListener('click', () => {
      window.location.href = '/custom-match';
    });

    // Logout button
    document.getElementById('logout-btn').addEventListener('click', async () => {
      try {
        await fetch('/api/auth/logout', { method: 'POST' });
        localStorage.removeItem('player');
        window.location.href = '/login';
      } catch (error) {
        console.error('Logout error:', error);
      }
    });

    // Initialize WebSocket
    initWebSocket(player.player_id);
  </script>
</body>
</html>
